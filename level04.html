<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Level 4 - Quick Math</title>
	<style>
		.button-style {
			position: fixed;
			transform: translate(-50%, -50%);
			font-size: clamp(32px, 6vw, 64px);
			padding: 3vh 8vw;
			border-radius: 20px;
			border: none;
			background: #0330f8;
			color: white;
			cursor: pointer;
			font-weight: bold;
		}

		.solution-button {
			display: none;
			position: fixed;
			transform: translate(-50%, -50%);
			font-size: clamp(20px, 3.5vw, 36px);
			padding: 2vh 2vw;
			width: 22vw;
			min-width: 120px;
			max-width: 200px;
			border-radius: 25px;
			border: none;
			background-color: rgb(174, 178, 170);
			color: rgb(0, 0, 0);
			cursor: pointer;
			text-align: center;
			box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
		}

		.score-style {
			position: fixed;
			top: 3vh;
			left: 4vw;
			font-size: clamp(24px, 4.5vw, 42px);
			color: rgb(3, 48, 248);
			margin: 0;
		}

		.result-style {
			display: none;
			position: fixed;
			transform: translate(-50%, -50%);
			font-size: clamp(40px, 8vw, 120px);
			padding: 1vh 2vw;
			border-radius: 20px;
			border: none;
			color: rgb(0, 0, 0);
			cursor: pointer;
			white-space: nowrap;
		}

		.back-button {
			position: fixed;
			top: 3vh;
			right: 4vw;
			font-size: clamp(20px, 3vw, 32px);
			padding: 1vh 2vw;
			border-radius: 15px;
			border: none;
			background: #0330f8;
			color: white;
			cursor: pointer;
			font-weight: bold;
		}

		.timer-style {
			position: fixed;
			top: 8vh;
			left: 49%;
			transform: translateX(-50%);
			font-size: clamp(24px, 4vw, 42px);
			color: rgb(88, 85, 85);
			margin: 0;
			font-weight: bold;
			display: none;
		}

		.description-style {
			position: fixed;
			top: 35%;
			left: 50%;
			transform: translate(-50%, -50%);
			font-size: clamp(20px, 3.5vw, 32px);
			color: rgb(50, 50, 50);
			margin: 0;
			text-align: center;
			font-weight: 500;
		}

		.victory-screen {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 255, 0, 0.9);
			z-index: 1000;
		}

		.victory-message {
			position: fixed;
			top: 30%;
			left: 50%;
			transform: translate(-50%, -50%);
			font-size: clamp(48px, 8vw, 80px);
			color: white;
			font-weight: bold;
			text-align: center;
			text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
		}

		.next-level-button {
			position: fixed;
			top: 60%;
			left: 50%;
			transform: translate(-50%, -50%);
			font-size: clamp(32px, 6vw, 64px);
			padding: 3vh 8vw;
			border-radius: 20px;
			border: none;
			background: white;
			color: #0330f8;
			cursor: pointer;
			font-weight: bold;
			box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
		}

		.next-level-button:hover {
			transform: translate(-50%, -50%) scale(1.05);
		}
	</style>
</head>
<body>
	<h1 style="
		text-align: center;
		font-size: clamp(32px, 5vw, 60px);
		margin: 2vh 0;
		">
		Level 4
	</h1>

	<button onclick="window.location.href='levels.html';" class="back-button">
		‚Üê Back
	</button>

	<h1 class="score-style">
		Score
	</h1>

	<h1 class="score-style" style="display: none;" id="Score">
	</h1>

	<h1 class="score-style" style="left: auto; right: 4vw; top: 8vh;" id="‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è">
	</h1>

	<h1 class="timer-style" id="timer">
		‚è±Ô∏è 30
	</h1>

	<p class="description-style" id="levelDescription">
		Score 5 points within 45 seconds
	</p>

	<button onclick="game()" class="button-style" style="top: 50%; left: 50%;" id="startButton">
		Start
	</button>

	<h1 class="result-style" style="top: 25%; left: 50%;" id="result">‚Äî
	</h1>

	<h1 onclick="is_solution(this)" class="solution-button" style="top: 60%; left: 68%;" id="solution1">‚Äî
	</h1>

	<h1 onclick="is_solution(this)" class="solution-button" style="top: 60%; left: 37%;" id="solution2">‚Äî
	</h1>

	<h1 onclick="is_solution(this)" class="solution-button" style="top: 76%; left: 37%;" id="solution3">‚Äî
	</h1>

	<h1 onclick="is_solution(this)" class="solution-button" style="top: 76%; left: 68%;" id="solution4">‚Äî
	</h1>

	<div class="victory-screen" id="victoryScreen">
		<div class="victory-message">
			üéâ LEVEL COMPLETE! üéâ
		</div>
		<button onclick="window.location.href='level05.html';" class="next-level-button">
			Next Level ‚Üí
		</button>
	</div>

	<script>
		let score = 0;
		let heart = 3;
		let correctAnswer = 0;
		let timeLeft = 45;
		let timerInterval = null;

		function updateHearts() {
			const heartsElement = document.getElementById("‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è");
			heartsElement.textContent = "‚ù§Ô∏è".repeat(heart);
		}

		function updateTimer() {
			const timerElement = document.getElementById("timer");
			timerElement.textContent = "‚è±Ô∏è " + timeLeft;
			
			if (timeLeft <= 0) {
				clearInterval(timerInterval);
				alert("TIME'S UP! Final Score: " + score);
				resetGame();
			}
		}

		function startTimer() {
			timeLeft = 45;
			document.getElementById("timer").style.display = "block";
			updateTimer();
			
			if (timerInterval) {
				clearInterval(timerInterval);
			}
			
			timerInterval = setInterval(() => {
				timeLeft--;
				updateTimer();
			}, 1000);
		}

		function generate_number() {
			return Math.floor(Math.random() * 99) + 1;
		}

		function generate_number2() {
			return Math.floor(Math.random() * 4);
		}

		function generate_symbol() {
			return Math.floor(Math.random() * 2);
		}

		function startGame() {
			updateHearts();
			const a = generate_number();
			const b = generate_number();
			const symbol = generate_symbol();
			const where_is_correct_anwser = generate_number2();

			if (symbol == 0) {
				correctAnswer = a + b;
			} else {
				if ((a-b)>0){
					correctAnswer = a - b;
				}
				else {
					correctAnswer = b - a;
				}
			}

			const result = document.getElementById("result");
			const solution1 = document.getElementById("solution1");
			const solution2 = document.getElementById("solution2");
			const solution3 = document.getElementById("solution3");
			const solution4 = document.getElementById("solution4");
			const Score = document.getElementById("Score");

			Score.textContent = "Score: " + score;
			Score.style.display = "block";

			if (symbol == 0) {
				result.textContent = a + " + " + b + " = ";
			} else {
				if ((a-b)>0){
					result.textContent = a + " - " + b + " = ";
				}
				else {
					result.textContent = b + " - " + a + " = ";
				}
			}
			result.style.display = "block";

			if (where_is_correct_anwser == 0) {
				solution1.textContent = correctAnswer;
				solution2.textContent = correctAnswer + 2;
				solution3.textContent = correctAnswer - 2;
				solution4.textContent = correctAnswer - 1;
			}
			if (where_is_correct_anwser == 1) {
				solution2.textContent = correctAnswer;
				solution1.textContent = correctAnswer + 2;
				solution4.textContent = correctAnswer - 2;
				solution3.textContent = correctAnswer - 1;
			}
			if (where_is_correct_anwser == 2) {
				solution3.textContent = correctAnswer;
				solution4.textContent = correctAnswer + 2;
				solution1.textContent = correctAnswer - 2;
				solution2.textContent = correctAnswer - 1;
			}
			if (where_is_correct_anwser == 3) {
				solution4.textContent = correctAnswer;
				solution1.textContent = correctAnswer + 2;
				solution3.textContent = correctAnswer - 2;
				solution2.textContent = correctAnswer - 1;
			}

			solution1.style.display = "block";
			solution2.style.display = "block";
			solution3.style.display = "block";
			solution4.style.display = "block";
		}

		function is_solution(el) {
			const value = Number(el.textContent);

			if (value === correctAnswer) {
				score++;
				
				// Check if player won the level
				if (score >= 5) {
					levelComplete();
					return;
				}
				
				document.body.style.backgroundColor = "rgb(0, 255, 0)";
				setTimeout(() => {
					document.body.style.backgroundColor = "white";
					startGame();
				}, 500);
			} else { 
				heart--;
				updateHearts();
				document.body.style.backgroundColor = "rgb(255, 0, 0)";
				
				if (heart!=0){
					setTimeout(() => {
						document.body.style.backgroundColor = "white";
						startGame();
					}, 1000);
				}
				else{
					setTimeout(() => {
						document.body.style.backgroundColor = "white";
						alert("GAME OVER!!!");
						resetGame();
					}, 1000);
				}
			}
		}

		function levelComplete() {
			// Save completion status
			localStorage.setItem('level04_completed', 'true');
			
			// Stop timer
			if (timerInterval) {
				clearInterval(timerInterval);
				timerInterval = null;
			}
			
			// Hide game elements
			document.getElementById("result").style.display = "none";
			document.getElementById("solution1").style.display = "none";
			document.getElementById("solution2").style.display = "none";
			document.getElementById("solution3").style.display = "none";
			document.getElementById("solution4").style.display = "none";
			document.getElementById("Score").style.display = "none";
			document.getElementById("timer").style.display = "none";
			document.getElementById("‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è").style.display = "none";
			
			// Show victory screen
			document.body.style.backgroundColor = "rgb(0, 255, 0)";
			setTimeout(() => {
				document.getElementById("victoryScreen").style.display = "block";
			}, 500);
		}

		function resetGame() {
			if (timerInterval) {
				clearInterval(timerInterval);
				timerInterval = null;
			}
			
			document.getElementById("result").style.display = "none";
			document.getElementById("solution1").style.display = "none";
			document.getElementById("solution2").style.display = "none";
			document.getElementById("solution3").style.display = "none";
			document.getElementById("solution4").style.display = "none";
			document.getElementById("Score").style.display = "none";
			document.getElementById("timer").style.display = "none";
			document.getElementById("levelDescription").style.display = "block";
			document.getElementById("startButton").style.display = "block";
			document.body.style.backgroundColor = "white";
			score = 0;
			heart = 3;
			timeLeft = 45;
		}

		function game() {
			score = 0;
			heart = 3;
			document.getElementById("startButton").style.display = "none";
			document.getElementById("levelDescription").style.display = "none";
			startTimer();
			startGame();
		}
	</script>
</body>
</html>
